# 要件定義書 - 日帰り旅行プランナー

## サービス概要

ユーザの現在地・予算・時間帯・交通手段を元に、AIが日帰り旅行プランを提案するWebサービス。
対象エリアは日本国内限定。

## ユーザフロー

### 1. アカウント登録 / ログイン

- Google OAuth
- LINE OAuth
- メールアドレス + パスワード

### 2. 条件入力

| 項目 | 詳細 |
|------|------|
| 現在地 | ブラウザの位置情報APIから取得、または手動入力 |
| 予算 | 上限金額を指定 |
| 時間帯 | 開始時刻〜終了時刻 |
| 交通手段 | 電車 / バス / 車 / 徒歩 など |

### 3. プラン生成

- AIが **2〜3パターン** のプランを生成
- 各プランに含まれる情報:
  - 観光スポット（最大3箇所）
  - 飲食店・カフェ
  - タイムスケジュール（交通手段ベースの時間割）
  - 予算内訳（交通費、食事代、入場料等）

### 4. プラン選択

- 2〜3パターンから1つを選択
- 再生成リクエスト可能（**1セッション最大3回まで**）
- プランを承認するまでを1セッションとしてカウント

### 5. 旅行中のスケジュール管理

- 承認したプランのタイムスケジュールを確認可能
- **手動リスケ機能**: ボタン1つで現在時刻・現在地ベースでスケジュールを再提案
- リスケ提案に対してユーザが承認 / 却下を選択

## データの正確性

外部APIから実データを取得し、AIのハルシネーションを防止する。

- スポット・飲食店の営業状況は Google Places API のデータに基づく
- 交通経路・所要時間は Google Directions API のデータに基づく
- AIにはデータ検索をさせず、取得済みの構造化データからプランを組み立てる役割に限定

### 注意事項

- 閉店済み・営業時間外の店舗を提案しない
- 曜日による交通機関の運行ダイヤの違いを考慮する
- 料金情報は外部APIのデータに準拠し、不明な場合は明示する

## 利用制限・マネタイズ

### 無料枠

- 累計で初回1セッションのみ無料

### 課金

- 2セッション目以降: 都度課金（100〜300円 / 1セッション）
- 決済: Stripe

### 広告

- 全ユーザに対して常時広告を表示（無料・課金問わず）

## 認証・アカウント管理

- ユーザ情報の管理（メールアドレス、OAuth連携情報）
- セッション履歴の保存
- 利用回数の追跡
- 課金記録の管理

## 技術スタック

| カテゴリ | 技術 |
|----------|------|
| フロントエンド | Nuxt 3 (Vue 3 + TypeScript) |
| ホスティング | Cloudflare Pages |
| バックエンド | Cloudflare Workers (Nitro) |
| データベース | Cloudflare D1 (SQLite) |
| AI | Claude API (プラン組み立て) |
| 地図・スポット | Google Places API |
| 交通経路 | Google Directions API |
| 決済 | Stripe |
| 認証 | OAuth (Google, LINE) + メール/パスワード |
| 国際化 | nuxt/i18n (MVPは日本語のみ、仕組みは初期から導入) |

## 非機能要件

- レスポンシブデザイン（モバイルファースト）
- スタイリッシュなUI
- API利用料金の管理・制限機構
